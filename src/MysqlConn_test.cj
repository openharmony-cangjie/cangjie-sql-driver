package mysql

import std.collection.*
import std.unittest.*
import std.unittest.testmacro.*

@Test
func writeHandshakeResponsePacketTest() {
    let conn = MysqlConn(Config("127.0.0.1", 3306, "root", "root", "test"))

    conn.buf.store(
        Array<UInt8>(
        [74, 0, 0, 0, 10, 56, 46, 48, 46, 51, 56, 0, 126, 0, 0, 0, 21, 90, 57, 121, 87, 48, 7, 63, 72, 7, 61, 52, 110,
        17, 26, 40, 108, 86, 94, 41, 0, 0, 0, 0, 0, 0, 0, 72, 7, 61, 52, 110, 17, 26, 40, 108, 86, 94, 41, 0, 99, 97,
        99, 104, 105, 110, 103, 95, 115, 104, 97, 50, 95, 112, 97, 115, 115, 119, 111, 114, 100, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]))
    let authResp = Array<UInt8>(
        [231, 145, 150, 173, 146, 11, 155, 17, 206, 192, 128, 146, 211, 35, 42, 86, 27, 36, 82, 159, 254, 9, 93, 204,
        81, 13, 159, 129, 176, 13, 168, 102])

    // 74,0,0,0,141,162,26,0,0,0,0,0,45,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,111,111,116,0,32,231,145,150,173,146,11,155,17,206,192,128,146,211,35,42,86,27,36,82,159,254,9,93,204,81,13,159,129,176,13,168,102,116,101,109,112,0,99,97,99,104,105,110,103,95,115,104,97,50,95,112,97,115,115,119,111,114,100,0,90,12,95,99,108,105,101,110,116,95,110,97,109,101,15,71,111,45,77,121,83,81,76,45,68,114,105,118,101,114,3,95,111,115,6,100,97,114,119,105,110,9,95,112,108,97,116,102,111,114,109,5,97,114,109,54,52,4,95,112,105,100,5,50,57,55,51,53,12,95,115,101,114,118,101,114,95,104,111,115,116,9,49,50,55,46,48,46,48,46,49
    conn.writeHandshakeResponsePacket(authResp, "caching_sha2_password")
}
